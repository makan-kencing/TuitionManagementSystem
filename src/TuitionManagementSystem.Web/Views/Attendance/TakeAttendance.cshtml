@{
    ViewData["Title"] = "Take Attendance";
}

<div class="container">
    <nav>
        <h4>Take Attendance</h4>

        <div class="d-flex justify-content-between align-items-center mb-4">
            <a class="btn btn-primary" asp-controller="Attendance" asp-action="Summary">
                Summary
            </a>
        </div>

    </nav>
    <form id="take" asp-controller="AttendanceApi" asp-action="TakeAttendanceCode">
        <div class="mb-3 mt-3">
            <label for="code" class="form-label">AttendanceCode:</label>
            <input type="text" class="form-control" id="code" placeholder="Enter Attendance Code" name="code">
        </div>
        <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal">
            Take Attendance
        </button>
    </form>
</div>


<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title"></h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                No Enter Code
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>

@section Scripts
{
    <script>
        $("#take").submit((e) => {
            e.preventDefault();
            console.log(e);

            const data = new FormData(e.target);

            $.ajax(
                e.target.action,
                {
                    method: e.target.method,
                    contentType: false,
                    processData: false,
                    data: data,
                    success: function (response) {
                        $("#myModal .modal-title").text("Attendance Success");
                        $("#myModal .modal-body").html(`<div class="alert alert-success">Attendance recorded successfully</div>`);
                        const modal = new bootstrap.Modal(document.getElementById("myModal"));
                        modal.show();
                    },
                    error: function (xhr) {

                        let message = "Attendance failed";

                        if (xhr.responseJSON && xhr.responseJSON.errors) {
                            message = xhr.responseJSON.errors.join("<br>");
                        }

                        $("#myModal .modal-title").text("Attendance Failed");
                        $("#myModal .modal-body").html(`<div class="alert alert-danger">${message}</div>
            `);

                        const modal = new bootstrap.Modal(document.getElementById("myModal"));
                        modal.show();
                    }
                });
        })
    </script>


}
