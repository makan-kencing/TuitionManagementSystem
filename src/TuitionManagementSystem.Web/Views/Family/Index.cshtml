@using TuitionManagementSystem.Web.Features.Family
@using TuitionManagementSystem.Web.Models.User
@using TuitionManagementSystem.Web.Services.Auth.Extensions
@model TuitionManagementSystem.Web.Features.Family.ViewFamilyViewModel

@{
    ViewData["Title"] = "Your Family";
}

<div class="container py-4">
    <partial name="Form/_EditNameDisplay"
             model="@new FamilyController.EditFamilyNameViewModel { Name = Model.Family.Name}"/>

    <div class="mt-4">
        <div>
            <h4>Your family group members</h4>
            <small>View and manage your family group.</small>
        </div>

        <div class="list-group mt-3">
            @foreach (var member in Model.Family.Members
                              .OrderByDescending(fm => fm.User.Type == nameof(Parent))
                              .ThenBy(fm => fm.User.Id == User.GetUserId()))
            {
                <div id="member-@(member.User.Id)" class="list-group-item list-group-item-action d-flex">
                    <div>
                        <a href="@member.User.AccountProfileImageUri" alt=""
                           class="rounded-circle" width="30" height="30"></a>
                    </div>

                    <div>
                        <h5>@member.User.AccountDisplayName @(member.User.Id == User.GetUserId() ? "(You)" : "")</h5>
                        <small>@member.User.Type</small>
                    </div>
                </div>
            }
        </div>

    </div>

    <div>
        @if (User.GetUserType() == nameof(Parent))
        {
            <div class="mt-3">
                <button hx-get
                        hx-controller="Family"
                        hx-action="GetInvite"
                        hx-target="#modal"
                        data-bs-toggle="modal"
                        data-bs-target="#modal"
                        class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i> Send Invitation
                </button>
            </div>
        }

        @if (User.GetUserType() == nameof(Parent) && Model.Family.Members.Count(fm => fm.User.Type == nameof(Parent)) == 1)
        {
            <button hx-get
                    hx-controller="Family"
                    hx-action="GetDeleteFamily"
                    hx-target="#modal"
                    data-bs-toggle="modal"
                    data-bs-target="#modal"
                    class="btn btn-danger mt-3">
                <i class="fa-solid fa-trash"></i> Delete Family Group
            </button>
        }
        else
        {
            <button hx-get
                    hx-controller="Family"
                    hx-action="GetLeaveFamily"
                    hx-target="#modal"
                    data-bs-toggle="modal"
                    data-bs-target="#modal"
                    class="btn btn-danger mt-3">
                <i class="fa-solid fa-right-from-bracket"></i> Leave Family Group
            </button>
        }
    </div>
</div>

<div id="modal" class="modal modal-blur fade"
     aria-hidden="false"
     tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content"></div>
    </div>
</div>

<div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3">
</div>

