@model TuitionManagementSystem.Web.Features.Authentication.Registration.RegisterViewModel
@{
    ViewData["Title"] = "Register";
}

<div class="min-vh-100 d-flex align-items-center justify-content-center bg-light">
    <div class="card shadow-lg border-0 rounded-4" style="max-width: 650px; width: 100%;">

        <div class="card-header bg-primary text-white text-center py-4 rounded-top-4">
            <h3 class="mb-0">Create Account</h3>
            <small>Select your role to continue</small>
        </div>

        <div class="card-body p-4">

            <div id="roleSelection" class="row g-3 text-center @(ViewData["ShowForm"] != null ? "d-none" : "")">
                <div class="col-md-6">
                    <div class="border rounded-4 p-4 h-100 role-card" onclick="selectRole('student')">
                        <i class="fa-solid fa-user-graduate fa-3x text-primary mb-3"></i>
                        <h5>Student</h5>
                        <p class="text-muted small">
                            Register as a student to access courses and attendance
                        </p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="border rounded-4 p-4 h-100 role-card" onclick="selectRole('parent')">
                        <i class="fa-solid fa-user-group fa-3x text-secondary mb-3"></i>
                        <h5>Parent</h5>
                        <p class="text-muted small">
                            Register as a parent to monitor your child’s progress
                        </p>
                    </div>
                </div>
            </div>

            <form id="studentForm"
                  asp-controller="Authentication"
                  asp-action="RegisterStudent"
                  method="post"
                  class="mt-3 @(ViewData["ShowForm"]?.ToString() == "student" ? "" : "d-none")">

                <h5 class="text-center mb-3">Student Registration</h5>

                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input name="Username" class="form-control" value="@Model?.Username" required />
                </div>

                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input name="Email" type="email" class="form-control" value="@Model?.Email" required />
                </div>

                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input name="Password" type="password" class="form-control" required minlength="6" />
                </div>

                <button type="submit" class="btn btn-primary w-100">Register as Student</button>
                <button type="button" class="btn btn-link w-100 mt-2" onclick="goBack()">← Change role</button>
            </form>

            <!-- PARENT FORM -->
            <form id="parentForm"
                  asp-controller="Authentication"
                  asp-action="RegisterParent"
                  method="post"
                  class="mt-3 @(ViewData["ShowForm"]?.ToString() == "parent" ? "" : "d-none")">

                <h5 class="text-center mb-3">Parent Registration</h5>

                <div class="mb-3">
                    <label class="form-label">Username</label>
                    <input name="Username" class="form-control" value="@Model?.Username" required />
                </div>

                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input name="Email" type="email" class="form-control" value="@Model?.Email" required />
                </div>

                <div class="mb-3">
                    <label class="form-label">Password</label>
                    <input name="Password" type="password" class="form-control" required minlength="6" />
                </div>

                <button type="submit" class="btn btn-secondary w-100">Register as Parent</button>
                <button type="button" class="btn btn-link w-100 mt-2" onclick="goBack()">← Change role</button>
            </form>

            <div class="text-center mt-4">
                <a asp-controller="Authentication" asp-action="Login" class="text-decoration-none small">
                    Already have an account? Login
                </a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<style>
.role-card {
    cursor: pointer;
    transition: all 0.25s ease;
    background-color: #fff;
}
.role-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 0.75rem 1.5rem rgba(0,0,0,.1);
    border-color: var(--bs-primary);
}
</style>

<script>
function selectRole(role) {
    document.getElementById("roleSelection").classList.add("d-none");

    if (role === "student") {
        document.getElementById("studentForm").classList.remove("d-none");
    } else {
        document.getElementById("parentForm").classList.remove("d-none");
    }
}

function goBack() {
    document.getElementById("studentForm").classList.add("d-none");
    document.getElementById("parentForm").classList.add("d-none");
    document.getElementById("roleSelection").classList.remove("d-none");
}

document.addEventListener("DOMContentLoaded", function() {
    var message = '@Html.Raw(TempData["RegisterMessage"])';
    var status = '@TempData["RegisterStatus"]';

    if (message) {
        Swal.fire({
            title: status === 'success' ? 'Success' : 'Error',
            html: message,
            icon: status === 'success' ? 'success' : 'error',
            showConfirmButton: true
        });
    }

    var showForm = '@ViewData["ShowForm"]';
    if(showForm === "student"){
        selectRole("student");
    } else if(showForm === "parent"){
        selectRole("parent");
    }
});
</script>
}
